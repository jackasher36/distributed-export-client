# AGEIPort Docker éƒ¨ç½²æŒ‡å—

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®å·²ç»é…ç½®å¥½äº†Dockerç¯å¢ƒï¼Œå¯ä»¥é€šè¿‡å®¹å™¨åŒ–æ–¹å¼è¿è¡ŒAGEIPortåº”ç”¨ã€‚é¡¹ç›®ä½¿ç”¨Spring Boot 2.7.9å’ŒJava 17ã€‚

## ğŸ“‹ æœ¬åœ°ä¾èµ–è§£å†³æ–¹æ¡ˆ

ç”±äºé¡¹ç›®åŒ…å«æœ¬åœ°Mavenä»“åº“ä¸­çš„ä¾èµ–ï¼ˆå¦‚ageiport-ext-file-store-minioï¼‰ï¼ŒDockeræ„å»ºéœ€è¦åˆ†ä¸¤æ­¥è¿›è¡Œï¼š

### æ­¥éª¤1ï¼šæ„å»ºjaræ–‡ä»¶ï¼ˆåœ¨å®¿ä¸»æœºä¸Šï¼‰
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨ç®¡ç†è„šæœ¬ï¼ˆæ¨èï¼‰
./run-docker.sh build-only-jar

# æ–¹æ³•2ï¼šç›´æ¥ä½¿ç”¨Maven
mvn clean package -DskipTests
```

### æ­¥éª¤2ï¼šæ„å»ºDockeré•œåƒ
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨ç®¡ç†è„šæœ¬ï¼ˆæ¨èï¼‰
./run-docker.sh build-only-docker

# æ–¹æ³•2ï¼šç›´æ¥ä½¿ç”¨Docker
docker build -t ageiport-app:latest .
```

### ä¸€é”®å®Œæ•´æ„å»º
```bash
# è‡ªåŠ¨æ‰§è¡Œæ­¥éª¤1å’Œæ­¥éª¤2
./run-docker.sh build
```

## ç«¯å£è¯´æ˜

| ç«¯å£å· | ç»„ä»¶                   | èŒè´£                                         |
| ------ | ---------------------- | -------------------------------------------- |
| 8775   | Spring Boot Web Server | æ¥æ”¶å¤–éƒ¨å‘½ä»¤ï¼šæ¥æ”¶ç”¨æˆ·å‘èµ·çš„å¯¼å‡ºè¯·æ±‚         |
| 9431   | HTTP Dispatcher        | åˆ†å‘å·¥ä½œï¼šæ¥æ”¶æ¥è‡ªåè°ƒèŠ‚ç‚¹çš„å­ä»»åŠ¡æŒ‡æ´¾       |
| 9742   | HTTP EventBus          | æ±‡æŠ¥è¿›åº¦ï¼šæ¥æ”¶æ¥è‡ªå·¥ä½œèŠ‚ç‚¹çš„çŠ¶æ€æ›´æ–°äº‹ä»¶     |
| 9741   | HTTP API Server        | å†…éƒ¨æŸ¥è¯¢ï¼šå“åº”æ¥è‡ªå…¶ä»–èŠ‚ç‚¹çš„å†…éƒ¨APIè°ƒç”¨      |

## é…ç½®è¯´æ˜

### æ•°æ®åº“é…ç½®
- MySQLåœ°å€ï¼š`macbook.local:3306`
- æ•°æ®åº“åï¼š`data_analyst_2318`
- ç”¨æˆ·åï¼š`root`
- å¯†ç ï¼š`casio233.`

### Eurekaé…ç½®
- Eurekaåœ°å€ï¼š`http://macbook.local:8761/eureka/`

### é˜¿é‡Œäº‘OSSé…ç½®
é˜¿é‡Œäº‘OSSé…ç½®å·²å†™æ­»åœ¨ä»£ç ä¸­ï¼ˆæŒ‰è¦æ±‚ï¼‰ï¼Œå¦‚éœ€ä¿®æ”¹è¯·æŸ¥çœ‹ `application-docker.yml` æ–‡ä»¶ã€‚

## å¿«é€Ÿå¼€å§‹

### æ–¹æ³•1ï¼šä½¿ç”¨ç®¡ç†è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# å®Œæ•´æ„å»ºå¹¶å¯åŠ¨åº”ç”¨
./run-docker.sh build && ./run-docker.sh run

# æŸ¥çœ‹æ—¥å¿—
./run-docker.sh logs

# æŸ¥çœ‹çŠ¶æ€
./run-docker.sh status

# åœæ­¢åº”ç”¨
./run-docker.sh stop
```

### æ–¹æ³•2ï¼šåˆ†æ­¥æ„å»ºï¼ˆé€‚ç”¨äºæœ¬åœ°ä¾èµ–é—®é¢˜ï¼‰

```bash
# æ­¥éª¤1ï¼šæ„å»ºjarï¼ˆè§£å†³æœ¬åœ°ä¾èµ–ï¼‰
./run-docker.sh build-only-jar

# æ­¥éª¤2ï¼šæ„å»ºDockeré•œåƒ
./run-docker.sh build-only-docker

# æ­¥éª¤3ï¼šå¯åŠ¨åº”ç”¨
./run-docker.sh run
```

### æ–¹æ³•3ï¼šä½¿ç”¨docker-compose

```bash
# å‰æï¼šç¡®ä¿jaræ–‡ä»¶å·²å­˜åœ¨
./run-docker.sh build-only-jar

# æ„å»ºå¹¶å¯åŠ¨
docker-compose up --build -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢
docker-compose down
```

## ğŸ“ æ„å»ºè„šæœ¬å‘½ä»¤è¯´æ˜

| å‘½ä»¤ | åŠŸèƒ½ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| `build` | å®Œæ•´æ„å»ºï¼ˆjar + Dockeré•œåƒï¼‰ | æ­£å¸¸æ„å»º |
| `build-only-jar` | ä»…æ„å»ºjaræ–‡ä»¶ | è§£å†³æœ¬åœ°ä¾èµ–é—®é¢˜ |
| `build-only-docker` | ä»…æ„å»ºDockeré•œåƒ | jarå·²å­˜åœ¨æ—¶ |
| `run` | å¯åŠ¨åº”ç”¨ | é•œåƒå·²æ„å»º |
| `stop` | åœæ­¢åº”ç”¨ | åœæ­¢æœåŠ¡ |
| `logs` | æŸ¥çœ‹æ—¥å¿— | è°ƒè¯•é—®é¢˜ |
| `status` | æŸ¥çœ‹çŠ¶æ€ | æ£€æŸ¥è¿è¡ŒçŠ¶æ€ |

## è®¿é—®åœ°å€

åº”ç”¨å¯åŠ¨åï¼Œå¯é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

- **ä¸»åº”ç”¨**: http://localhost:8775
- **Dispatcher**: http://localhost:9431
- **EventBus**: http://localhost:9742
- **API Server**: http://localhost:9741

## å¥åº·æ£€æŸ¥

å®¹å™¨è‡ªå¸¦å¥åº·æ£€æŸ¥åŠŸèƒ½ï¼Œä¼šå®šæœŸæ£€æŸ¥åº”ç”¨çŠ¶æ€ï¼š
- æ£€æŸ¥é—´éš”ï¼š30ç§’
- è¶…æ—¶æ—¶é—´ï¼š10ç§’
- å¯åŠ¨æ—¶é—´ï¼š60ç§’

## æ•…éšœæ’é™¤

### ğŸ”§ æœ¬åœ°ä¾èµ–é—®é¢˜
å¦‚æœé‡åˆ°ä¾èµ–æ‰¾ä¸åˆ°çš„é”™è¯¯ï¼š
```bash
# 1. ç¡®ä¿æœ¬åœ°Mavenä»“åº“ä¸­æœ‰ä¾èµ–
mvn dependency:tree

# 2. å•ç‹¬æ„å»ºjar
./run-docker.sh build-only-jar

# 3. æ£€æŸ¥targetç›®å½•
ls -la target/demo-ageiport-*.jar
```

### ğŸ” æŸ¥çœ‹åº”ç”¨æ—¥å¿—
```bash
./run-docker.sh logs
# æˆ–
docker-compose logs -f ageiport-app
```

### ğŸ”§ è¿›å…¥å®¹å™¨è°ƒè¯•
```bash
./run-docker.sh shell
# æˆ–
docker exec -it ageiport-container sh
```

### ğŸ§¹ æ¸…ç†Dockerèµ„æº
```bash
./run-docker.sh cleanup
```

## ğŸš€ æ‰©å±•æ€§è€ƒè™‘

- åˆ†ç¦»æ„å»ºé™ä½Dockeræ„å»ºå¤æ‚åº¦
- æ”¯æŒæœ¬åœ°ä¾èµ–å’Œç§æœ‰ä»“åº“
- érootç”¨æˆ·è¿è¡Œæé«˜å®‰å…¨æ€§
- èµ„æºé™åˆ¶å’Œå¥åº·æ£€æŸ¥
- è‡ªå®šä¹‰ç½‘ç»œæ”¯æŒé›†ç¾¤éƒ¨ç½²
- æ—¥å¿—è½®è½¬é¿å…ç£ç›˜æ»¡
- ç¯å¢ƒå˜é‡æ”¯æŒåŠ¨æ€é…ç½®

## å‰ç½®æ¡ä»¶

ç¡®ä¿ä»¥ä¸‹æœåŠ¡åœ¨`macbook.local`ä¸Šè¿è¡Œï¼š
1. MySQL (ç«¯å£3306)
2. EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒ (ç«¯å£8761)

## æ–‡ä»¶è¯´æ˜

- `Dockerfile`: å•é˜¶æ®µDockeræ„å»ºæ–‡ä»¶ï¼ˆä½¿ç”¨é¢„æ„å»ºjarï¼‰
- `docker-compose.yml`: Docker Composeé…ç½®æ–‡ä»¶
- `.dockerignore`: Dockeræ„å»ºå¿½ç•¥æ–‡ä»¶
- `application-docker.yml`: Dockerç¯å¢ƒä¸“ç”¨é…ç½®
- `run-docker.sh`: Dockerç®¡ç†è„šæœ¬ï¼ˆæ”¯æŒåˆ†æ­¥æ„å»ºï¼‰ 